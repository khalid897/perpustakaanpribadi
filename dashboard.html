<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Dashboard Admin</title>
  <link rel="icon" href="logo.png" type="image/png">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background: linear-gradient(135deg, #00C9FF, #92FE9D);
      padding: 20px;
      margin: 0;
    }
    h1 {
      text-align: center;
      color: #333;
    }
    .stats {
      display: flex;
      justify-content: space-around;
      margin: 30px 0;
      flex-wrap: wrap;
    }
    .stat-box {
      background: white;
      border-radius: 10px;
      padding: 20px;
      min-width: 200px;
      margin: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      text-align: center;
    }
    canvas {
      max-width: 600px;
      margin: 30px auto;
      display: block;
    }
    .recent-books {
      max-width: 600px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .recent-books h3 {
      margin-bottom: 10px;
    }
    .recent-books ul {
      padding-left: 20px;
    }
  </style>
</head>
<body>

  <h1>📊 Dashboard Admin</h1>

  <div class="stats">
    <div class="stat-box" id="totalBuku">Total Buku: ...</div>
    <div class="stat-box" id="totalKategori">Kategori Unik: ...</div>
  </div>

  <canvas id="kategoriChart"></canvas>

  <div class="recent-books">
    <h3>📕 Buku Terbaru</h3>
    <ul id="recentList">Memuat...</ul>
  </div>

  <script>
    const supabase = window.supabase.createClient(
      'https://xbbodgtxbjqoqxmzqrva.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhiYm9kZ3R4Ympxb3F4bXpxcnZhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAwNzIxNTksImV4cCI6MjA2NTY0ODE1OX0.2JcNFYUasDTbZF6u6R5xUsdh8dilxUiFvoMYp4MmL9s'
    );

    async function loadDashboard() {
      const { data: buku, error } = await supabase.from("buku").select("*");
      if (error || !buku) {
        alert("❌ Gagal mengambil data buku.");
        return;
      }

      // Total Buku
      document.getElementById("totalBuku").textContent = "Total Buku: " + buku.length;

      // Kategori Unik
      const kategoriSet = new Set(buku.map(b => b.kategori || "Lainnya"));
      document.getElementById("totalKategori").textContent = "Kategori Unik: " + kategoriSet.size;

      // Buku Terbaru
      const recent = buku.sort((a, b) => b.id - a.id).slice(0, 5);
      const list = document.getElementById("recentList");
      list.innerHTML = recent.map(b => `<li><strong>${b.judul}</strong> oleh ${b.penulis}</li>`).join("");

      // Chart per Kategori
      const kategoriCount = {};
      buku.forEach(b => {
        const kategori = b.kategori || "Lainnya";
        kategoriCount[kategori] = (kategoriCount[kategori] || 0) + 1;
      });

      const ctx = document.getElementById("kategoriChart").getContext("2d");
      new Chart(ctx, {
        type: "pie",
        data: {
          labels: Object.keys(kategoriCount),
          datasets: [{
            data: Object.values(kategoriCount),
            backgroundColor: ["#ff6384", "#36a2eb", "#ffcd56", "#4bc0c0", "#9966ff", "#c9cbcf"]
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'bottom' }
          }
        }
      });
    }

    loadDashboard();
  </script>

</body>
</html>
